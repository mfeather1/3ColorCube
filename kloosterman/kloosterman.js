/* 
  Usage:

   1. Include these in web page:
      <script src=rch.js></script>
      <script src=rclib.js></script>
      <script src=kloosterman.js></script>

   2. Call hk_init() once and then call hk_make_configs(n) where n is the
      selected list type.  The resulting generated list of facelets will
      be stored in the kloosterman array for access on the web page.
      See make_configs.html for example usage.

  ----------------------------------------------------------------------------
  Counting Kloosterman Stage 4 Configs using 3-Color Cube Components
  ----------------------------------------------------------------------------
 
  3-Color Cube Components
  -----------------------
  CP = 70 3-Color Corner Positions
  EP = 34650 3-Color Edge Positions
  CPR = 576 6-Color Corner Positions (3-color reduced)
  EPR = 13824 6-Color Edge Positions (3-color reduced)

  With Kloosterman's method, the 576 corner configs in stage 4 are a
  combination of 36 CP configs with 12 lists of 16 CPR configs which are
  shown in the definition of the arrays "cp_list" and "cpr_list" in the code
  below. Each CP config is combined with one CPR list but multiple CP's are
  combined to the same CPR list. The table below shows how the combinations
  make a total of 576 configs.  The Lists and Use columns are the count
  distribution from array "cpr_idx" below (each number in cpr_idx links a
  CP config to a CPR list), CP = Lists*Use, CP+CPR = CP*16.
                  
  Lists  Use   CP  CP+CPR
  -----  ---  ---  ------
    2     1     2     32
    4     2     8    128
    4     4    16    256 
    2     5    10    160
  -----  ---  ---  ------
   12          36    576

  Similarly, the 13824 edge configs are a combination of 36 EP configs with
  6 lists of 384 EPR configs which are shown in the definition of the arrays
  "ep_list" and "epr_list" in the code below. The following table shows how
  the combinations make a total of 13824 configs.

  Lists  Use   EP  EP+EPR
  -----  ---  ---  ------
    4      3   12    4608
    2     12   24    9216
  -----  ---  ---  ------
    6          36   13824
*/
var kloosterman = [];
var cp_list = [0,2,3,5,8,9,10,13,14,15,18,19,20,23,24,27,32,33,36,37,42,45,46,49,50,51,54,55,56,59,60,61,64,66,67,69];
var cpr_idx = [0,1,1,2,4,0,0,3,3,2,4,0,0,3,3,6,4,4,10,10,11,7,7,9,9,10,8,7,7,9,9,10,8,5,5,9];
var cpr_list = [
  [0,2,21,23,48,50,69,71,504,506,525,527,552,554,573,575],
  [6,11,12,17,54,59,60,65,510,515,516,521,558,563,564,569],
  [24,26,45,47,72,74,93,95,480,482,501,503,528,530,549,551],
  [25,27,44,46,73,75,92,94,481,483,500,502,529,531,548,550],
  [28,29,42,43,76,77,90,91,484,485,498,499,532,533,546,547],
  [31,34,37,40,79,82,85,88,487,490,493,496,535,538,541,544],
  [100,101,114,115,124,125,138,139,436,437,450,451,460,461,474,475],
  [150,155,156,161,270,275,276,281,294,299,300,305,414,419,420,425],
  [174,179,180,185,246,251,252,257,318,323,324,329,390,395,396,401],
  [175,178,181,184,247,250,253,256,319,322,325,328,391,394,397,400],
  [198,203,204,209,222,227,228,233,342,347,348,353,366,371,372,377],
  [200,201,206,207,224,225,230,231,344,345,350,351,368,369,374,375]
];
var ep_list = [0,1,2,7,8,10,11,12,13,17,18,20,21,22,23,30,33,34,35,36,39,46,47,48,49,51,52,56,57,58,59,61,62,67,68,69];
var epr_idx = [0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5];
var epr_list = [
  [0,1,6,7,48,49,54,55,504,505,510,511,552,553,558,559,576,577,582,583,624,625,630,631,1080,1081,1086,1087,1128,1129,1134,1135,1152,1153,1158,1159,1200,1201,1206,1207,1656,1657,1662,1663,1704,1705,1710,1711,1728,1729,1734,1735,1776,1777,1782,1783,2232,2233,2238,2239,2280,2281,2286,2287,2304,2305,2310,2311,2352,2353,2358,2359,2808,2809,2814,2815,2856,2857,2862,2863,2880,2881,2886,2887,2928,2929,2934,2935,3384,3385,3390,3391,3432,3433,3438,3439,3456,3457,3462,3463,3504,3505,3510,3511,3960,3961,3966,3967,4008,4009,4014,4015,4032,4033,4038,4039,4080,4081,4086,4087,4536,4537,4542,4543,4584,4585,4590,4591,4608,4609,4614,4615,4656,4657,4662,4663,5112,5113,5118,5119,5160,5161,5166,5167,5184,5185,5190,5191,5232,5233,5238,5239,5688,5689,5694,5695,5736,5737,5742,5743,5760,5761,5766,5767,5808,5809,5814,5815,6264,6265,6270,6271,6312,6313,6318,6319,6336,6337,6342,6343,6384,6385,6390,6391,6840,6841,6846,6847,6888,6889,6894,6895,6912,6913,6918,6919,6960,6961,6966,6967,7416,7417,7422,7423,7464,7465,7470,7471,7488,7489,7494,7495,7536,7537,7542,7543,7992,7993,7998,7999,8040,8041,8046,8047,8064,8065,8070,8071,8112,8113,8118,8119,8568,8569,8574,8575,8616,8617,8622,8623,8640,8641,8646,8647,8688,8689,8694,8695,9144,9145,9150,9151,9192,9193,9198,9199,9216,9217,9222,9223,9264,9265,9270,9271,9720,9721,9726,9727,9768,9769,9774,9775,9792,9793,9798,9799,9840,9841,9846,9847,10296,10297,10302,10303,10344,10345,10350,10351,10368,10369,10374,10375,10416,10417,10422,10423,10872,10873,10878,10879,10920,10921,10926,10927,10944,10945,10950,10951,10992,10993,10998,10999,11448,11449,11454,11455,11496,11497,11502,11503,11520,11521,11526,11527,11568,11569,11574,11575,12024,12025,12030,12031,12072,12073,12078,12079,12096,12097,12102,12103,12144,12145,12150,12151,12600,12601,12606,12607,12648,12649,12654,12655,12672,12673,12678,12679,12720,12721,12726,12727,13176,13177,13182,13183,13224,13225,13230,13231,13248,13249,13254,13255,13296,13297,13302,13303,13752,13753,13758,13759,13800,13801,13806,13807],
  [36,38,42,44,84,86,90,92,492,494,498,500,540,542,546,548,612,614,618,620,660,662,666,668,1068,1070,1074,1076,1116,1118,1122,1124,1188,1190,1194,1196,1236,1238,1242,1244,1644,1646,1650,1652,1692,1694,1698,1700,1764,1766,1770,1772,1812,1814,1818,1820,2220,2222,2226,2228,2268,2270,2274,2276,2340,2342,2346,2348,2388,2390,2394,2396,2796,2798,2802,2804,2844,2846,2850,2852,2916,2918,2922,2924,2964,2966,2970,2972,3372,3374,3378,3380,3420,3422,3426,3428,3492,3494,3498,3500,3540,3542,3546,3548,3948,3950,3954,3956,3996,3998,4002,4004,4068,4070,4074,4076,4116,4118,4122,4124,4524,4526,4530,4532,4572,4574,4578,4580,4644,4646,4650,4652,4692,4694,4698,4700,5100,5102,5106,5108,5148,5150,5154,5156,5220,5222,5226,5228,5268,5270,5274,5276,5676,5678,5682,5684,5724,5726,5730,5732,5796,5798,5802,5804,5844,5846,5850,5852,6252,6254,6258,6260,6300,6302,6306,6308,6372,6374,6378,6380,6420,6422,6426,6428,6828,6830,6834,6836,6876,6878,6882,6884,6948,6950,6954,6956,6996,6998,7002,7004,7404,7406,7410,7412,7452,7454,7458,7460,7524,7526,7530,7532,7572,7574,7578,7580,7980,7982,7986,7988,8028,8030,8034,8036,8100,8102,8106,8108,8148,8150,8154,8156,8556,8558,8562,8564,8604,8606,8610,8612,8676,8678,8682,8684,8724,8726,8730,8732,9132,9134,9138,9140,9180,9182,9186,9188,9252,9254,9258,9260,9300,9302,9306,9308,9708,9710,9714,9716,9756,9758,9762,9764,9828,9830,9834,9836,9876,9878,9882,9884,10284,10286,10290,10292,10332,10334,10338,10340,10404,10406,10410,10412,10452,10454,10458,10460,10860,10862,10866,10868,10908,10910,10914,10916,10980,10982,10986,10988,11028,11030,11034,11036,11436,11438,11442,11444,11484,11486,11490,11492,11556,11558,11562,11564,11604,11606,11610,11612,12012,12014,12018,12020,12060,12062,12066,12068,12132,12134,12138,12140,12180,12182,12186,12188,12588,12590,12594,12596,12636,12638,12642,12644,12708,12710,12714,12716,12756,12758,12762,12764,13164,13166,13170,13172,13212,13214,13218,13220,13284,13286,13290,13292,13332,13334,13338,13340,13740,13742,13746,13748,13788,13790,13794,13796],
  [112,113,118,119,136,137,142,143,448,449,454,455,472,473,478,479,688,689,694,695,712,713,718,719,1024,1025,1030,1031,1048,1049,1054,1055,1264,1265,1270,1271,1288,1289,1294,1295,1600,1601,1606,1607,1624,1625,1630,1631,1840,1841,1846,1847,1864,1865,1870,1871,2176,2177,2182,2183,2200,2201,2206,2207,2416,2417,2422,2423,2440,2441,2446,2447,2752,2753,2758,2759,2776,2777,2782,2783,2992,2993,2998,2999,3016,3017,3022,3023,3328,3329,3334,3335,3352,3353,3358,3359,3568,3569,3574,3575,3592,3593,3598,3599,3904,3905,3910,3911,3928,3929,3934,3935,4144,4145,4150,4151,4168,4169,4174,4175,4480,4481,4486,4487,4504,4505,4510,4511,4720,4721,4726,4727,4744,4745,4750,4751,5056,5057,5062,5063,5080,5081,5086,5087,5296,5297,5302,5303,5320,5321,5326,5327,5632,5633,5638,5639,5656,5657,5662,5663,5872,5873,5878,5879,5896,5897,5902,5903,6208,6209,6214,6215,6232,6233,6238,6239,6448,6449,6454,6455,6472,6473,6478,6479,6784,6785,6790,6791,6808,6809,6814,6815,7024,7025,7030,7031,7048,7049,7054,7055,7360,7361,7366,7367,7384,7385,7390,7391,7600,7601,7606,7607,7624,7625,7630,7631,7936,7937,7942,7943,7960,7961,7966,7967,8176,8177,8182,8183,8200,8201,8206,8207,8512,8513,8518,8519,8536,8537,8542,8543,8752,8753,8758,8759,8776,8777,8782,8783,9088,9089,9094,9095,9112,9113,9118,9119,9328,9329,9334,9335,9352,9353,9358,9359,9664,9665,9670,9671,9688,9689,9694,9695,9904,9905,9910,9911,9928,9929,9934,9935,10240,10241,10246,10247,10264,10265,10270,10271,10480,10481,10486,10487,10504,10505,10510,10511,10816,10817,10822,10823,10840,10841,10846,10847,11056,11057,11062,11063,11080,11081,11086,11087,11392,11393,11398,11399,11416,11417,11422,11423,11632,11633,11638,11639,11656,11657,11662,11663,11968,11969,11974,11975,11992,11993,11998,11999,12208,12209,12214,12215,12232,12233,12238,12239,12544,12545,12550,12551,12568,12569,12574,12575,12784,12785,12790,12791,12808,12809,12814,12815,13120,13121,13126,13127,13144,13145,13150,13151,13360,13361,13366,13367,13384,13385,13390,13391,13696,13697,13702,13703,13720,13721,13726,13727],
  [192,193,198,199,216,217,222,223,336,337,342,343,360,361,366,367,768,769,774,775,792,793,798,799,912,913,918,919,936,937,942,943,1344,1345,1350,1351,1368,1369,1374,1375,1488,1489,1494,1495,1512,1513,1518,1519,1920,1921,1926,1927,1944,1945,1950,1951,2064,2065,2070,2071,2088,2089,2094,2095,2496,2497,2502,2503,2520,2521,2526,2527,2640,2641,2646,2647,2664,2665,2670,2671,3072,3073,3078,3079,3096,3097,3102,3103,3216,3217,3222,3223,3240,3241,3246,3247,3648,3649,3654,3655,3672,3673,3678,3679,3792,3793,3798,3799,3816,3817,3822,3823,4224,4225,4230,4231,4248,4249,4254,4255,4368,4369,4374,4375,4392,4393,4398,4399,4800,4801,4806,4807,4824,4825,4830,4831,4944,4945,4950,4951,4968,4969,4974,4975,5376,5377,5382,5383,5400,5401,5406,5407,5520,5521,5526,5527,5544,5545,5550,5551,5952,5953,5958,5959,5976,5977,5982,5983,6096,6097,6102,6103,6120,6121,6126,6127,6528,6529,6534,6535,6552,6553,6558,6559,6672,6673,6678,6679,6696,6697,6702,6703,7104,7105,7110,7111,7128,7129,7134,7135,7248,7249,7254,7255,7272,7273,7278,7279,7680,7681,7686,7687,7704,7705,7710,7711,7824,7825,7830,7831,7848,7849,7854,7855,8256,8257,8262,8263,8280,8281,8286,8287,8400,8401,8406,8407,8424,8425,8430,8431,8832,8833,8838,8839,8856,8857,8862,8863,8976,8977,8982,8983,9000,9001,9006,9007,9408,9409,9414,9415,9432,9433,9438,9439,9552,9553,9558,9559,9576,9577,9582,9583,9984,9985,9990,9991,10008,10009,10014,10015,10128,10129,10134,10135,10152,10153,10158,10159,10560,10561,10566,10567,10584,10585,10590,10591,10704,10705,10710,10711,10728,10729,10734,10735,11136,11137,11142,11143,11160,11161,11166,11167,11280,11281,11286,11287,11304,11305,11310,11311,11712,11713,11718,11719,11736,11737,11742,11743,11856,11857,11862,11863,11880,11881,11886,11887,12288,12289,12294,12295,12312,12313,12318,12319,12432,12433,12438,12439,12456,12457,12462,12463,12864,12865,12870,12871,12888,12889,12894,12895,13008,13009,13014,13015,13032,13033,13038,13039,13440,13441,13446,13447,13464,13465,13470,13471,13584,13585,13590,13591,13608,13609,13614,13615],
  [170,172,176,178,242,244,248,250,314,316,320,322,386,388,392,394,746,748,752,754,818,820,824,826,890,892,896,898,962,964,968,970,1322,1324,1328,1330,1394,1396,1400,1402,1466,1468,1472,1474,1538,1540,1544,1546,1898,1900,1904,1906,1970,1972,1976,1978,2042,2044,2048,2050,2114,2116,2120,2122,2474,2476,2480,2482,2546,2548,2552,2554,2618,2620,2624,2626,2690,2692,2696,2698,3050,3052,3056,3058,3122,3124,3128,3130,3194,3196,3200,3202,3266,3268,3272,3274,3626,3628,3632,3634,3698,3700,3704,3706,3770,3772,3776,3778,3842,3844,3848,3850,4202,4204,4208,4210,4274,4276,4280,4282,4346,4348,4352,4354,4418,4420,4424,4426,4778,4780,4784,4786,4850,4852,4856,4858,4922,4924,4928,4930,4994,4996,5000,5002,5354,5356,5360,5362,5426,5428,5432,5434,5498,5500,5504,5506,5570,5572,5576,5578,5930,5932,5936,5938,6002,6004,6008,6010,6074,6076,6080,6082,6146,6148,6152,6154,6506,6508,6512,6514,6578,6580,6584,6586,6650,6652,6656,6658,6722,6724,6728,6730,7082,7084,7088,7090,7154,7156,7160,7162,7226,7228,7232,7234,7298,7300,7304,7306,7658,7660,7664,7666,7730,7732,7736,7738,7802,7804,7808,7810,7874,7876,7880,7882,8234,8236,8240,8242,8306,8308,8312,8314,8378,8380,8384,8386,8450,8452,8456,8458,8810,8812,8816,8818,8882,8884,8888,8890,8954,8956,8960,8962,9026,9028,9032,9034,9386,9388,9392,9394,9458,9460,9464,9466,9530,9532,9536,9538,9602,9604,9608,9610,9962,9964,9968,9970,10034,10036,10040,10042,10106,10108,10112,10114,10178,10180,10184,10186,10538,10540,10544,10546,10610,10612,10616,10618,10682,10684,10688,10690,10754,10756,10760,10762,11114,11116,11120,11122,11186,11188,11192,11194,11258,11260,11264,11266,11330,11332,11336,11338,11690,11692,11696,11698,11762,11764,11768,11770,11834,11836,11840,11842,11906,11908,11912,11914,12266,12268,12272,12274,12338,12340,12344,12346,12410,12412,12416,12418,12482,12484,12488,12490,12842,12844,12848,12850,12914,12916,12920,12922,12986,12988,12992,12994,13058,13060,13064,13066,13418,13420,13424,13426,13490,13492,13496,13498,13562,13564,13568,13570,13634,13636,13640,13642],
  [99,101,105,107,123,125,129,131,435,437,441,443,459,461,465,467,675,677,681,683,699,701,705,707,1011,1013,1017,1019,1035,1037,1041,1043,1251,1253,1257,1259,1275,1277,1281,1283,1587,1589,1593,1595,1611,1613,1617,1619,1827,1829,1833,1835,1851,1853,1857,1859,2163,2165,2169,2171,2187,2189,2193,2195,2403,2405,2409,2411,2427,2429,2433,2435,2739,2741,2745,2747,2763,2765,2769,2771,2979,2981,2985,2987,3003,3005,3009,3011,3315,3317,3321,3323,3339,3341,3345,3347,3555,3557,3561,3563,3579,3581,3585,3587,3891,3893,3897,3899,3915,3917,3921,3923,4131,4133,4137,4139,4155,4157,4161,4163,4467,4469,4473,4475,4491,4493,4497,4499,4707,4709,4713,4715,4731,4733,4737,4739,5043,5045,5049,5051,5067,5069,5073,5075,5283,5285,5289,5291,5307,5309,5313,5315,5619,5621,5625,5627,5643,5645,5649,5651,5859,5861,5865,5867,5883,5885,5889,5891,6195,6197,6201,6203,6219,6221,6225,6227,6435,6437,6441,6443,6459,6461,6465,6467,6771,6773,6777,6779,6795,6797,6801,6803,7011,7013,7017,7019,7035,7037,7041,7043,7347,7349,7353,7355,7371,7373,7377,7379,7587,7589,7593,7595,7611,7613,7617,7619,7923,7925,7929,7931,7947,7949,7953,7955,8163,8165,8169,8171,8187,8189,8193,8195,8499,8501,8505,8507,8523,8525,8529,8531,8739,8741,8745,8747,8763,8765,8769,8771,9075,9077,9081,9083,9099,9101,9105,9107,9315,9317,9321,9323,9339,9341,9345,9347,9651,9653,9657,9659,9675,9677,9681,9683,9891,9893,9897,9899,9915,9917,9921,9923,10227,10229,10233,10235,10251,10253,10257,10259,10467,10469,10473,10475,10491,10493,10497,10499,10803,10805,10809,10811,10827,10829,10833,10835,11043,11045,11049,11051,11067,11069,11073,11075,11379,11381,11385,11387,11403,11405,11409,11411,11619,11621,11625,11627,11643,11645,11649,11651,11955,11957,11961,11963,11979,11981,11985,11987,12195,12197,12201,12203,12219,12221,12225,12227,12531,12533,12537,12539,12555,12557,12561,12563,12771,12773,12777,12779,12795,12797,12801,12803,13107,13109,13113,13115,13131,13133,13137,13139,13347,13349,13353,13355,13371,13373,13377,13379,13683,13685,13689,13691,13707,13709,13713,13715]
];
var cp_cpr_to_cp6c = [];
function hk_init() {
  init2();
  assign_centers_6c();
  populate_cp_cpr_to_cp6c(); 
}
function hk_make_configs(type) {
  kloosterman.length = 0;
  if (type == 1) make_corners(0);
  if (type == 2) make_corners(1);
  if (type == 3) make_edges(0);
  if (type == 4) make_edges(1);    
  if (type == 5) make_both(0);
  if (type == 6) make_both(1);
}
function make_corners(chk_par) {
  var cs = [];
  int_to_perm(0, eps, 12);
  for (var i=0, ix=0; i < 36; i++) {
    for (var j=0; j < 16; j++) {
      var cpr = cpr_list[cpr_idx[i]][j]; 
      var cp6c = cp_cpr_to_cp6c[cp_list[i]][cpr];
      int_to_perm(cp6c, cps, 8);
      if (chk_par)
        if (parity(eps, 12) != parity(cps, 8))
          continue;
      make_cubestr();
      colorize(cs);
      kloosterman[ix++] = cs.join('');
    }
  }
}
function make_edges(chk_par) {
  var cs = [];
  var epr = new Int8Array(3);
  int_to_perm(0, cps, 8);
  for (var i=0, ix=0; i < 36; i++) {
    for (var j=0; j < 384; j++) {
      var n = epr_list[epr_idx[i]][j]; 
      epr[0] = n/576;
      epr[1] = (n/24)%24;
      epr[2] = n%24;
      make_eps(eps, ep_list[i], epr);
      if (chk_par)
        if (parity(eps, 12) != parity(cps, 8))
	  continue;
      make_cubestr();
      colorize(cs);
      kloosterman[ix++] = cs.join('');
    }
  }
}
function make_both(chk_par) {
  console.log('make_both');
  var cs = [];
  var epr = new Int8Array(3);
  for (var i=0, ix=0; i < 36; i++) {
    console.log((i+1) + ' of 36');
    for (var j=0; j < 16; j++) {
      var cpr = cpr_list[cpr_idx[i]][j]; 
      var cp6c = cp_cpr_to_cp6c[cp_list[i]][cpr];
      int_to_perm(cp6c, cps, 8);
      for (var k=0; k < 36; k++) {
        for (var l=0; l < 384; l++) {
          var n = epr_list[epr_idx[k]][l];
          epr[0] = n/576;
          epr[1] = (n/24)%24;
          epr[2] = n%24;
          make_eps(eps, ep_list[k], epr);
          if (chk_par)
            if (parity(eps, 12) != parity(cps, 8))
              continue;
          make_cubestr();
          colorize(cs);
          kloosterman[ix++] = cs.join('');
        }
      }
    }
  }
}
function make_eps(eps, ep, epr) {
  var eps_3c = new Int8Array(12);
  var eps_3r = new Int8Array(12);
  var s = new Int8Array(4);
  var ix = new Int8Array(3);
  int_to_strp(ep_b3[ep], eps_3c, 11, 3);
  for (var i=0; i < 3; i++) {
    int_to_perm(epr[i], s, 4);
    for (var j=0; j < 4; j++)
      eps_3r[i*4+j] = s[j];
  }
  for (var i=0; i < 12; i++) {
    var n = eps_3c[i];
    eps[i] = n*4 + eps_3r[n*4+ix[n]];
    ix[n]++;
  }
}
function populate_cp_cpr_to_cp6c() {
  for (var i=0; i < 70; i++)
    cp_cpr_to_cp6c[i] = [];
  for (var i=0; i < 40320; i++) {
    var cp = cp6c_cp3c[i];
    var cpr = cp6c_cpr[i];
    cp_cpr_to_cp6c[cp][cpr] = i;
  }
}
function colorize(cs) {
  for (var i=0; i < 54; i++) {
    if      (cubestr[i] == 0) cs[i] = 'B';
    else if (cubestr[i] == 1) cs[i] = 'Y';
    else if (cubestr[i] == 2) cs[i] = 'R';
    else if (cubestr[i] == 3) cs[i] = 'G';
    else if (cubestr[i] == 4) cs[i] = 'W';
    else if (cubestr[i] == 5) cs[i] = 'O';
  }
}
